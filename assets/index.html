<!DOCTYPE html>
<html>

<head>
    <title>Project Esperanza</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<style>
/* Resetting default margin and padding for the body */
body {
  margin: 0;
  padding: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #1f1f1f; /* Darker background */
  color: #cfcfcf; /* Light text */
  width: 80%; /* Set the width of the page */
  margin: 0 auto; /* Center align the content */
}

h1{
    color: rgb(201, 201, 201);
}
/* Form styles */
form {
  margin-bottom: 20px;
}

.input-group {
  margin-bottom: 10px;
}

label {
  display: block;
  margin-bottom: 5px;
  font-size: 1.1em;
}

input[type="text"] {
  width: calc(100% - 20px);
  padding: 10px;
  font-size: 1em;
  border: none;
  background-color: #282828;
  color: #e2e2e2;
  border-radius: 5px;
  border: 1px solid #474a4d; /* Increased contrast */
}

button {
  padding: 10px 20px;
  font-size: 1em;
  background-color: #4caf50;
  color: rgb(255, 255, 255);
  border: none;
  cursor: pointer;
  border-radius: 5px;
}

button:hover {
  background-color: #388e3c;
}

/* Output area styles */
.outputArea {
  background-color: #282828;
  padding: 20px;
  margin-bottom: 20px;
  border-radius: 5px;
  border: 1px solid #474a4d; /* Increased contrast */
}

/* Table styles */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  border-radius: 5px;
}

th, td {
  padding: 15px;
  text-align: left;
  border-bottom: 1px solid #474a4d; /* Darker border for cells */
}

th {
  background-color: #4caf50;
  color: white;
}

/* Zebra striping for rows */
tbody tr:nth-child(even) {
  background-color: #33363A; /* Darker background for even rows */
}

tbody tr:hover {
  background-color: #474a4d; /* Hover color for rows */
}

</style>

<body>
    <div id="container">
        <h1>Data Retrieval Made fast üêá</h1>
        <form id="inputForm">
            <div class="input-group">
                <label for="queryInput">Enter your Question:</label>
                <input type="text" id="queryInput" name="queryInput" class="inputsearch">
            </div>
            <button type="submit">Submit</button>
        </form>
        <h3>Your Query</h3>
        <div id="outputQuery" class="outputArea">
            <!-- Output content will be displayed here -->
        </div>
        <h3>Your Output</h3>
        <div id="outputResult" class="outputArea">
            <!-- Output content will be displayed here -->
        </div>
    </div>

    <script>

        document.getElementById('inputForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const input = document.getElementById('queryInput').value;
            const outputquery = document.getElementById('outputQuery');
            const outputresult = document.getElementById('outputResult');
            console.log(input);
            outputquery.innerHTML = "we are preparing your answer";
            outputresult.innerHTML = "we are preparing your answer";
            fetch('/submit-query', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                // body: JSON.stringify({ query: input })
                body: JSON.stringify({ myinput: input })
            })
                .then(response => response.json())
                .then(data => {
                    // Handle the response from the server if needed

                    if(data.error == true){
                        outputquery.innerHTML = data.message;
                        outputresult.innerHTML =  data.message;
                    }
                    else if (data.query_string == undefined ) {
                        outputquery.innerHTML = "cannot Generate query for this input or you may not have data related to it";
                        outputresult.innerHTML =  "cannot Generate query for this input or you may not have data related to it";
                    } else {
                        outputquery.innerHTML = data.query_string;
                        outputresult.innerHTML = ' ';
                        
                        if (Object.keys(data.query_output).length === 0) {
                            const tableDiv = document.getElementById('outputResult');
                            tableDiv.innerHTML = "Cannot genrate data for this query"
                        } else {

                            const result = data.query_output;
                        const tableDiv = document.getElementById('outputResult');

                        // Create a table element
                        const table = document.createElement('table');

                        // Create table header
                        const headers = Object.keys(result[0]);
                        const headerRow = document.createElement('tr');
                        headers.forEach(headerText => {
                            const header = document.createElement('th');
                            header.appendChild(document.createTextNode(headerText));
                            headerRow.appendChild(header);
                        });
                        table.appendChild(headerRow);

                        // Create table rows with data
                        result.forEach(obj => {
                            const row = document.createElement('tr');
                            headers.forEach(header => {
                                const cell = document.createElement('td');
                                cell.appendChild(document.createTextNode(obj[header]));
                                row.appendChild(cell);
                            });
                            table.appendChild(row);
                        });

                        // Append the table to the specified div
                        tableDiv.appendChild(table);
                        }
                    }

                });
        });
                </script>
    </body>
    
    </html>